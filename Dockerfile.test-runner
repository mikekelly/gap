# Test runner image for GAP integration tests
# Based on Debian slim with curl, jq, sha512sum, and openssl (for Ed25519 signing tests)

FROM debian:bookworm-slim

# Install test dependencies
# openssl is needed for Ed25519 signing in test-docker-signing.sh
RUN apt-get update && \
    apt-get install -y \
    curl \
    jq \
    coreutils \
    openssl \
    && rm -rf /var/lib/apt/lists/*

# Create test user
RUN useradd -m -s /bin/bash tester

# Set up working directory
WORKDIR /tests

# Copy test script directly (since smoke-tests/ is in .dockerignore)
# We'll create it inline or mount it
# For now, create a placeholder that will be overridden by volume mount

# Make test directory writable
RUN mkdir -p /tests && chown tester:tester /tests

# Switch to test user
USER tester

# Default command runs the integration tests
CMD ["/bin/bash", "/tests/test-docker-integration.sh"]
